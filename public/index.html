<!doctype html>
<meta charset="utf-8" />
<title>My n8n Chat</title>
<style>
  body{margin:0;font:16px/1.5 "Inter",sans-serif;background:#f9fafb;display:flex;justify-content:center;}
  .chat{width:100%;max-width:720px;height:90vh;border:1px solid #e5e7eb;border-radius:12px;background:#fff;
        display:flex;flex-direction:column;}
  .msgs{flex:1;overflow-y:auto;padding:1rem;}
  .bubble{display:inline-block;padding:.5rem 1rem;border-radius:12px;white-space:pre-line;margin-bottom:1rem;
          max-width:80%;}
  .user  {background:#2563eb;color:#fff;border-bottom-right-radius:0;align-self:flex-end;}
  .bot   {background:#f3f4f6;color:#111827;border-bottom-left-radius:0;align-self:flex-start;}
  .composer{padding:1rem;border-top:1px solid #e5e7eb;background:#fafafa;}
  textarea{width:100%;padding:.75rem;border:1px solid #d1d5db;border-radius:8px;resize:none;font-family:inherit;}
  button{width:100%;margin-top:.5rem;padding:.75rem;border:none;border-radius:8px;background:#2563eb;color:#fff;}
</style>

<div class="chat">
  <div id="msgs" class="msgs"></div>

  <form id="composer" class="composer">
    <textarea id="input" rows="2" placeholder="Type…"></textarea>
    <button>Send</button>
  </form>
</div>

<script>
const webhook = 'https://deepfeed.app.n8n.cloud/webhook-test/17893bdb-97ae-4ba9-9c97-7ec6f0e644bb';
const sessionId = localStorage.getItem('sid') || (crypto.randomUUID());
localStorage.setItem('sid', sessionId);

const msgs = document.getElementById('msgs');
const input = document.getElementById('input');
document.getElementById('composer').addEventListener('submit', async e => {
  e.preventDefault();
  const txt = input.value.trim();
  if (!txt) return;
  add(txt, 'user'); input.value = '';

  const loader = add('…', 'bot');
  try {
    const res = await fetch(`${webhook}?action=sendMessage`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ chatInput: txt, sessionId })
    });
    const { responses=[] } = await res.json();
    loader.remove();
    responses.forEach(r => add(r, 'bot'));
  } catch(err){
    loader.textContent = '⚠️ error';
    console.error(err);
  }
});

function add(text, role){
  const div = document.createElement('div');
  div.className = `bubble ${role==='user'?'user':'bot'}`;
  div.textContent = text;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
  return div;
}
</script>
